<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Ruleta de Mar√≠a Teresa üé°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .wheel-container {
            position: relative;
            width: 500px;
            height: 500px;
            transition: transform 0.3s ease;
        }

        @media (max-width: 640px) {
            .wheel-container {
                width: 90vw;
                height: 90vw;
            }
        }

        #wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            transition: transform 6s cubic-bezier(0.25, 1, 0.5, 1);
            transform-origin: center;
        }

        .pointer {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 35px solid #ef4444; /* red-500 */
            transform: translate(-50%, -100%) rotate(180deg);
            z-index: 10;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.4));
            transition: transform 0.3s ease;
        }
       
        .pointer::before {
            content: '';
            position: absolute;
            top: -45px;
            left: -12.5px;
            width: 25px;
            height: 25px;
            background-color: #f87171; /* red-400 */
            border-radius: 50%;
            border: 3px solid #fca5a5; /* red-300 */
        }

        .action-button {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1), 0 4px 6px rgba(0,0,0,0.1);
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15), 0 6px 8px rgba(0,0,0,0.15);
        }

        .action-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
       
        .action-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: translateY(0);
        }

        #modal {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .modal-enter {
            opacity: 0;
            transform: scale(0.9) translateY(20px);
        }

        .modal-leave {
            opacity: 0;
            transform: scale(0.9) translateY(20px);
        }
       
        .question-text {
            font-size: clamp(2.5rem, 6vw, 4rem);
            line-height: 1.2;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.2);
        }

        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 100;
        }
    </style>
</head>
<body class="text-gray-800 flex flex-col items-center justify-center p-4 space-y-8">

    <canvas id="confetti-canvas"></canvas>

    <header class="text-center">
        <h1 class="text-4xl md:text-5xl font-extrabold text-gray-700 tracking-tight">
            La Ruleta de <span class="text-transparent bg-clip-text bg-gradient-to-r from-rose-500 to-pink-500">Mar√≠a Teresa</span> üé°
        </h1>
        <p class="mt-2 text-lg text-gray-500">Gira la ruleta y descubre la pregunta</p>
    </header>

    <main class="flex flex-col items-center justify-center space-y-6">
        <div class="wheel-container">
            <div class="pointer"></div>
            <canvas id="wheel" width="500" height="500"></canvas>
        </div>
        <div class="flex items-center space-x-4">
            <button id="spin-button" class="action-button px-10 py-4 bg-gradient-to-r from-purple-500 to-indigo-600 text-white font-bold text-2xl rounded-full shadow-lg">
                GIRAR üöÄ
            </button>
            <button id="reset-button" class="action-button hidden px-6 py-3 bg-amber-500 hover:bg-amber-600 text-white font-bold text-lg rounded-full shadow-lg">
                REINICIAR üîÑ
            </button>
        </div>
    </main>

    <!-- Modal para la pregunta -->
    <div id="modal" class="modal-enter fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden">
        <div id="modal-content" class="bg-white rounded-2xl shadow-2xl p-8 md:p-12 w-full max-w-4xl text-center relative transform">
            <p id="question-text" class="question-text font-black text-gray-800"></p>
            <div class="mt-12 flex flex-col sm:flex-row justify-center gap-4">
                <button id="keep-button" class="w-full sm:w-auto px-8 py-3 bg-green-500 hover:bg-green-600 text-white font-bold text-lg rounded-xl transition duration-300">
                    ‚úÖ Mantener Pregunta
                </button>
                <button id="remove-button" class="w-full sm:w-auto px-8 py-3 bg-red-500 hover:bg-red-600 text-white font-bold text-lg rounded-xl transition duration-300">
                    ‚ùå Eliminar Pregunta
                </button>
            </div>
        </div>
    </div>

    <script>
        const wheel = document.getElementById('wheel');
        const spinButton = document.getElementById('spin-button');
        const resetButton = document.getElementById('reset-button');
        const modal = document.getElementById('modal');
        const questionText = document.getElementById('question-text');
        const keepButton = document.getElementById('keep-button');
        const removeButton = document.getElementById('remove-button');
        const ctx = wheel.getContext('2d');

        const confettiCanvas = document.getElementById('confetti-canvas');
        const confettiCtx = confettiCanvas.getContext('2d');
        let particles = [];

        // --- Datos de la ruleta ---
        const originalQuestions = [
            { keyword: "LO M√ÅS LLAMATIVO ü§î", text: "Cuenta lo que m√°s te ha llamado la atenci√≥n", color: "#ef4444" },
            { keyword: "CANCI√ìN üéµ", text: "¬øA qu√© an√©cdota de las le√≠das hace referencia la canci√≥n ‚ÄúHaciendo el bien‚Äù?", color: "#f97316" },
            { keyword: "PASTOR RAFAEL üêë", text: "¬øQu√© le pas√≥ al Pastor Rafael? ¬øC√≥mo salv√≥ M¬™ Teresa la situaci√≥n?", color: "#eab308" },
            { keyword: "EL TOLEDILLO üèòÔ∏è", text: "¬øQui√©nes viv√≠an en el Barrio del Toledillo?", color: "#84cc16" },
            { keyword: "EL HOSPITALILLO üè•", text: "¬øQu√© era el Hospitalillo?", color: "#22c55e" },
            { keyword: "TAREAS HOSPITALILLO üßë‚Äç‚öïÔ∏è", text: "¬øQu√© hac√≠a M¬™ Teresa en el Hospitalillo?", color: "#14b8a6" },
            { keyword: "LLAMADAS NOCTURNAS üåô", text: "¬øQu√© hac√≠a M¬™ Teresa con los que llamaban de noche a la puerta del sanatorio?", color: "#06b6d4" },
            { keyword: "SALTARSE NORMAS ü§´", text: "¬øCu√°ndo se saltaba las normas M¬™ Teresa?", color: "#6366f1" },
            { keyword: "EL LEPROSO üò•", text: "¬øQu√© hac√≠a M¬™ Teresa con el leproso?", color: "#a855f7" },
            { keyword: "LOS GITANILLOS üëßüèΩüë¶üèΩ", text: "¬øQu√© hac√≠a M¬™ Teresa con los gitanillos?", color: "#ec4899" },
        ];
        let questions = [...originalQuestions];

        let currentRotation = 0;
        let isSpinning = false;
        let selectedQuestion = null;

        const drawWheel = () => {
            const numSegments = questions.length;
            if (numSegments === 0) {
                ctx.clearRect(0, 0, wheel.width, wheel.height);
                ctx.save();
                ctx.font = 'bold 24px Poppins';
                ctx.fillStyle = '#4b5563';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('¬°No quedan m√°s preguntas! üéâ', wheel.width / 2, wheel.height / 2);
                ctx.restore();
                spinButton.disabled = true;
                spinButton.innerText = 'FIN üëã';
                return;
            }
           
            const anglePerSegment = (2 * Math.PI) / numSegments;
            const radius = wheel.width / 2;

            ctx.clearRect(0, 0, wheel.width, wheel.height);
            ctx.font = 'bold 16px Poppins';
           
            questions.forEach((segment, i) => {
                const startAngle = i * anglePerSegment;
                const endAngle = (i + 1) * anglePerSegment;

                ctx.beginPath();
                ctx.moveTo(radius, radius);
                ctx.arc(radius, radius, radius - 5, startAngle, endAngle);
                ctx.closePath();
                ctx.fillStyle = segment.color;
                ctx.fill();
                ctx.strokeStyle = "white";
                ctx.lineWidth = 4;
                ctx.stroke();

                ctx.save();
                ctx.translate(radius, radius);
                ctx.rotate(startAngle + anglePerSegment / 2);
                ctx.textAlign = 'right';
                ctx.fillStyle = '#ffffff';
                ctx.shadowColor = 'rgba(0,0,0,0.3)';
                ctx.shadowBlur = 3;
               
                const text = segment.keyword;
                ctx.fillText(text, radius * 0.9, 10);
               
                ctx.restore();
            });
        };

        const spin = () => {
            if (isSpinning || questions.length === 0) return;
            isSpinning = true;
            spinButton.disabled = true;
            spinButton.innerText = 'GIRANDO... üòµ‚Äçüí´';

            const randomSpins = Math.floor(Math.random() * 5) + 5;
            const randomExtraRotation = Math.random() * 360;
            const totalRotation = randomSpins * 360 + randomExtraRotation;
            const newRotation = currentRotation + totalRotation;

            wheel.style.transition = 'transform 6s cubic-bezier(0.25, 1, 0.5, 1)';
            wheel.style.transform = `rotate(${newRotation}deg)`;
            currentRotation = newRotation;
        };
       
        const handleSpinEnd = () => {
            isSpinning = false;
            spinButton.disabled = false;
            spinButton.innerText = 'GIRAR üöÄ';
           
            const numSegments = questions.length;
            if(numSegments === 0) return;

            const actualRotation = currentRotation % 360;
            const anglePerSegment = 360 / numSegments;
            const pointerAngle = 270; // El puntero est√° arriba, que es -90 o 270 grados
            const finalAngle = (actualRotation + pointerAngle) % 360;
            const winningIndex = Math.floor(numSegments - (finalAngle / anglePerSegment)) % numSegments;

            selectedQuestion = questions[winningIndex];
            showModal();
        };

        const showModal = () => {
            questionText.innerText = selectedQuestion.text;
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('modal-enter');
                triggerConfetti();
            }, 10);
        };
       
        const hideModal = () => {
            modal.classList.add('modal-leave');
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('modal-leave');
                modal.classList.add('modal-enter');
            }, 300);
        };
       
        const resetGame = () => {
            questions = [...originalQuestions];
            wheel.style.transition = 'none';
            wheel.style.transform = 'rotate(0deg)';
            currentRotation = 0;
           
            setTimeout(() => {
                drawWheel();
                spinButton.disabled = false;
                spinButton.innerText = 'GIRAR üöÄ';
                resetButton.classList.add('hidden');
            }, 50);
        };

        keepButton.addEventListener('click', () => hideModal());
       
        removeButton.addEventListener('click', () => {
            if (selectedQuestion) {
                questions = questions.filter(q => q.text !== selectedQuestion.text);
                resetButton.classList.remove('hidden');
               
                wheel.style.transition = 'none';
                wheel.style.transform = 'rotate(0deg)';
                currentRotation = 0;
               
                setTimeout(() => drawWheel(), 50);
            }
            hideModal();
        });

        // --- L√≥gica del Confeti ---
        const triggerConfetti = () => {
            particles = [];
            const confettiCount = 200;
            const power = 15;
            const particleColors = originalQuestions.map(q => q.color);

            for (let i = 0; i < confettiCount; i++) {
                particles.push({
                    x: confettiCanvas.width / 2,
                    y: confettiCanvas.height / 2,
                    color: particleColors[Math.floor(Math.random() * particleColors.length)],
                    radius: Math.random() * 5 + 2,
                    vx: (Math.random() - 0.5) * power,
                    vy: (Math.random() - 0.5) * power,
                    alpha: 1,
                    decay: Math.random() * 0.02 + 0.01
                });
            }
            animateConfetti();
        };

        const animateConfetti = () => {
            confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
            particles.forEach((p, index) => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.2; // Gravedad
                p.alpha -= p.decay;

                if (p.alpha <= 0) {
                    particles.splice(index, 1);
                } else {
                    confettiCtx.globalAlpha = p.alpha;
                    confettiCtx.beginPath();
                    confettiCtx.arc(p.x, p.y, p.radius, 0, Math.PI * 2, false);
                    confettiCtx.fillStyle = p.color;
                    confettiCtx.fill();
                }
            });
           
            if (particles.length > 0) {
                requestAnimationFrame(animateConfetti);
            } else {
                confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
            }
        };

        spinButton.addEventListener('click', spin);
        resetButton.addEventListener('click', resetGame);
        wheel.addEventListener('transitionend', handleSpinEnd);

        // --- Inicializaci√≥n ---
        const setupCanvas = () => {
            const container = document.querySelector('.wheel-container');
            const size = Math.min(500, window.innerWidth * 0.8, window.innerHeight * 0.6);
            container.style.width = `${size}px`;
            container.style.height = `${size}px`;
            wheel.width = size;
            wheel.height = size;

            confettiCanvas.width = window.innerWidth;
            confettiCanvas.height = window.innerHeight;
            drawWheel();
        };
       
        window.addEventListener('resize', setupCanvas);
        window.onload = setupCanvas;
    </script>
</body>
</html>
